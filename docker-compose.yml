version: "3"
services:
  jasmin:
    build:
      context: ./
      dockerfile: ./docker/Dockerfile.dev
    container_name: jasmin
    volumes:
      - ./jasmin:/usr/jasmin/jasmin
    ports:
      - 2775:2775
      - 8990:8990
      - 1401:1401
    env_file: .env
    depends_on:
      - redis
      - rabbit-mq
  test:
    build:
      context: ./
      dockerfile: ./docker/Dockerfile.test
    container_name: jasmin-tests
    volumes:
      - ./jasmin:/usr/jasmin/jasmin
      - ./tests:/usr/jasmin/tests
    environment: 
      - AMQP_BROKER_HOST=rabbit-mq
      - REDIS_CLIENT_HOST=redis
    depends_on:
      - redis
      - rabbit-mq
  redis:
    image: redis:alpine
  rabbit-mq:
    image: rabbitmq:alpine
